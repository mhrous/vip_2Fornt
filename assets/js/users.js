$(document).ready(function(){testLogin("users");let e=null,t=[];const o=()=>{const o=$("#all-users-table").DataTable({paging:!1,searching:!1,columnDefs:[{orderable:!1,targets:1},{orderable:!1,targets:5,width:"50px"},{targets:2,width:"100px"},{targets:3,width:"50px"},{orderable:!1,targets:4,width:"70px"}]});$("body").on("click",".remove-table",function(){const e=$(this).data("id"),a=o.row("#"+$(this).data("id")),n=t.findIndex(t=>t._id==e);swal({title:`هل تريد حذف ${t[n].name}`,type:"info",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"نعم",cancelButtonText:"لا"},function(o){o&&deleteUser({id:e,success(){swal("حذف","","success"),a.remove().draw(),t=[...t.slice(0,n),...t.slice(n+1)]}})})}),$("body").on("click",".edit-table",function(){const o=$(this).data("id"),a=t.find(e=>e._id==o);$("#user-modal #modal").modal("show"),e.H_.title="تعديل مستحدم",e.H_.edit=!0,e.H_.okBtnTitle="تعديل",e.H_.id=o,e.name=a.name,e.address=a.address,e.phone=a.phone,e.power=a.power});const a={D:"سائق",P:"شريك",S:"سكرتيرة",s_admin:"مشرف"},n=e=>{t=[...t,e];const n=o.row.add([e.name,renderPhone(e.phone),e.address,a[e.power],e.password,renderTableAction(e._id)]).draw(!1).node();$(n).attr("id",e._id)};return getUser({success({data:e}){e.forEach(e=>{n(e)})}}),{addToTable:n,editFromTable:({id:e,data:n})=>{t=t.map(t=>t._id==e?n:t);o.row("#"+e).data([n.name,renderPhone(n.phone),n.address,a[n.power],n.password,renderTableAction(n._id)]).draw(!1)}}},a=({addToTable:t,editFromTable:o})=>{e=new Vue({el:"#user-modal #modal",data:{H_:{title:"",okBtnTitle:"",edit:null},name:"",address:"",phone:[{phoneType:"اساسي",value:""}],power:"D"},methods:{ok(){const e=JSON.parse(JSON.stringify(this.$data));if(delete e.H_,(e=>{if(!e.name||!e.address||!e.phone)return!1;for(let{value:t,phoneType:o}of e.phone)if(!t||!o)return!1;return!0})(e)){if(this.H_.edit){const t=this.H_.id;putUser({id:t,data:e,success({data:e}){o({data:e,id:t})},error(e){swal({title:e.responseJSON.error,type:"info",confirmButtonText:"اعد التعبئة",closeOnConfirm:!1})}})}else addUser({data:e,success({data:e}){t(e)},error(e){swal({title:e.responseJSON.error,type:"info",confirmButtonText:"اعد التعبئة",closeOnConfirm:!1})}});$("#user-modal #modal").modal("hide")}else swal({title:"بعض الحقول ناقصة",type:"warning",confirmButtonText:"اعد التعبئة",closeOnConfirm:!1})},newPhone(){this.phone=[...this.phone,{phoneType:"",value:"",_id:(new Date).getTime()}]},removePhon(e){this.phone=this.phone.filter(t=>t._id!==e)}}});const a=$("#new-user"),n=$("#user-modal #modal");a.on("click",()=>{n.modal("show"),e.H_.title="اضافة مستحدم",e.H_.edit=!1,e.H_.okBtnTitle="اضافة",e.name="",e.address="",e.phone=[{phoneType:"اساسي",value:""}],e.power="D"})};(()=>{const{addToTable:e,editFromTable:t}=o();renderSiteBar(),a({addToTable:e,editFromTable:t})})()});